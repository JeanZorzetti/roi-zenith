// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Lead {
  id              String   @id @default(cuid())
  fullName        String   @map("full_name")
  email           String   @unique
  company         String
  role            String
  companySector   String   @map("company_sector")
  teamSize        String   @map("team_size")
  monthlyLeads    String   @map("monthly_leads")
  budget          String
  currentChallenges String @map("current_challenges") @db.Text
  timeline        String
  gdprConsent     Boolean  @default(true) @map("gdpr_consent")
  marketingConsent Boolean @default(false) @map("marketing_consent")
  status          LeadStatus @default(NEW)
  score           Int      @default(0)
  source          String
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("leads")
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  name        String
  password    String
  role        UserRole @default(USER)
  avatar      String?
  company     String?
  position    String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  boards      Board[]
  boardMembers BoardMember[]

  @@map("users")
}

model Board {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  color       String   @default("bg-blue-500")
  isPublic    Boolean  @default(false) @map("is_public")
  isFavorite  Boolean  @default(false) @map("is_favorite")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  userId      String?  @map("user_id")
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  columns     Column[]
  members     BoardMember[]

  @@map("boards")
}

model Column {
  id          String   @id @default(cuid())
  title       String
  color       String   @default("bg-gray-500")
  position    Int      @default(0)
  isExpanded  Boolean  @default(true) @map("is_expanded")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  boardId     String   @map("board_id")
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  tasks       Task[]
  subColumns  SubColumn[]

  @@map("columns")
}

model SubColumn {
  id          String   @id @default(cuid())
  title       String
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  columnId    String   @map("column_id")
  column      Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)
  tasks       Task[]

  @@map("sub_columns")
}

model Task {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  priority    TaskPriority @default(MEDIUM)
  assignee    String?
  dueDate     DateTime? @map("due_date")
  tags        Json     @default("[]")
  completed   Boolean  @default(false)
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  columnId    String   @map("column_id")
  column      Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)

  subColumnId String?  @map("sub_column_id")
  subColumn   SubColumn? @relation(fields: [subColumnId], references: [id], onDelete: Cascade)

  checklist   ChecklistItem[]

  @@map("tasks")
}

model ChecklistItem {
  id          String   @id @default(cuid())
  text        String
  completed   Boolean  @default(false)
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  taskId      String   @map("task_id")
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@map("checklist_items")
}

model BoardMember {
  id          String   @id @default(cuid())
  email       String
  name        String
  permission  MemberPermission @default(VIEW)
  invitedAt   DateTime @default(now()) @map("invited_at")

  // Relations
  boardId     String   @map("board_id")
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  userId      String?  @map("user_id")
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@unique([boardId, email])
  @@map("board_members")
}

model Campaign {
  id          String   @id @default(cuid())
  name        String
  type        String
  status      CampaignStatus @default(DRAFT)
  budget      Decimal
  spent       Decimal  @default(0)
  impressions Int      @default(0)
  clicks      Int      @default(0)
  conversions Int      @default(0)
  startDate   DateTime @map("start_date")
  endDate     DateTime? @map("end_date")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("campaigns")
}

model Analytics {
  id        String   @id @default(cuid())
  metric    String
  value     Decimal
  date      DateTime
  category  String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("analytics")
}

model Report {
  id          String   @id @default(cuid())
  title       String
  description String? @db.Text
  type        String
  data        Json
  generatedBy String   @map("generated_by")
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("reports")
}

// CRM Models
model Pipeline {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  color       String   @default("#3b82f6")
  isDefault   Boolean  @default(false) @map("is_default")
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  stages      PipelineStage[]
  deals       Deal[]

  @@map("pipelines")
}

model PipelineStage {
  id          String   @id @default(cuid())
  title       String
  color       String   @default("#6366f1")
  position    Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  pipelineId  String   @map("pipeline_id")
  pipeline    Pipeline @relation(fields: [pipelineId], references: [id], onDelete: Cascade)
  deals       Deal[]

  @@map("pipeline_stages")
}

model Company {
  id          String   @id @default(cuid())
  name        String
  sector      String?
  size        String?
  website     String?
  phone       String?
  address     String?  @db.Text
  notes       String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  contacts    Contact[]
  deals       Deal[]

  @@map("companies")
}

model Contact {
  id          String   @id @default(cuid())
  firstName   String   @map("first_name")
  lastName    String   @map("last_name")
  email       String?
  phone       String?
  position    String?
  notes       String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  companyId   String?  @map("company_id")
  company     Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)
  deals       Deal[]
  activities  Activity[]

  @@map("contacts")
}

model Deal {
  id            String      @id @default(cuid())
  title         String
  description   String?     @db.Text
  value         Decimal     @default(0) @db.Decimal(10, 2)
  currency      String      @default("BRL")
  probability   Int         @default(0)
  expectedCloseDate DateTime? @map("expected_close_date")
  closedDate    DateTime?   @map("closed_date")
  lostReason    String?     @map("lost_reason") @db.Text
  position      Int         @default(0)
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  // Relations
  pipelineId    String      @map("pipeline_id")
  pipeline      Pipeline    @relation(fields: [pipelineId], references: [id], onDelete: Cascade)
  stageId       String      @map("stage_id")
  stage         PipelineStage @relation(fields: [stageId], references: [id], onDelete: Cascade)
  companyId     String?     @map("company_id")
  company       Company?    @relation(fields: [companyId], references: [id], onDelete: SetNull)
  contactId     String?     @map("contact_id")
  contact       Contact?    @relation(fields: [contactId], references: [id], onDelete: SetNull)
  activities    Activity[]

  @@map("deals")
}

model Activity {
  id          String        @id @default(cuid())
  type        ActivityType
  subject     String
  description String?       @db.Text
  dueDate     DateTime?     @map("due_date")
  completed   Boolean       @default(false)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  // Relations
  dealId      String?       @map("deal_id")
  deal        Deal?         @relation(fields: [dealId], references: [id], onDelete: Cascade)
  contactId   String?       @map("contact_id")
  contact     Contact?      @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@map("activities")
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  DEMO_SCHEDULED
  PROPOSAL_SENT
  CLOSED_WON
  CLOSED_LOST
}

enum ActivityType {
  CALL
  EMAIL
  MEETING
  NOTE
  TASK
}

enum UserRole {
  ADMIN
  USER
  MANAGER
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
}

enum MemberPermission {
  VIEW
  EDIT
}
